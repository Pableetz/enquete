name: EnquÃªte policiÃ¨re SuperPrix

on: 
  push:

jobs:
  policier-scene:
    runs-on: ubuntu-latest
    outputs:
      empreinte: "empreinte trouvÃ©e sur la caisse"
    steps:
      - name: Observation de la scÃ¨ne
        run: echo "Le policier examine la caisse enregistreuse"
      - name: PrÃ©lÃ¨vement dâ€™empreinte
        run: echo "Empreinte prÃ©levÃ©e sur la caisse"

  policier-video:
    runs-on: ubuntu-latest
    outputs:
      video: ${{ steps.get_video.outputs.resultat }}
    steps:
      - name: RÃ©cupÃ©ration vidÃ©o
        id: get_video
        run: echo "resultat=SÃ©quence vidÃ©o 22h15-22h45 rÃ©cupÃ©rÃ©e" >> $GITHUB_OUTPUT

  detective:
    runs-on: ubuntu-latest
    needs: [policier-scene, policier-video]
    outputs:
      rapport: ${{ steps.rapport-final.outputs.conclusion }}
      lieu_arrestation: ${{ steps.rapport-final.outputs.lieu }}
      autorisation_arrestation: ${{ steps.rapport-final.outputs.autorisation }}
    steps:
      - name: Affichage des indices
        run: |
          echo "Indice empreinte : ${{ needs.policier-scene.outputs.empreinte }}"
          echo "Indice vidÃ©o : ${{ needs.policier-video.outputs.video }}"

      - name: Analyse des indices
        run: |
          echo "ANALYSE_EMPREINTE=Empreinte correspond Ã  un suspect connu" >> $GITHUB_ENV
          echo "ANALYSE_VIDEO=Suspect identifiÃ© sur la vidÃ©o Ã  22h30" >> $GITHUB_ENV

      - name: Rapport final
        id: rapport-final
        run: |
          echo "conclusion=${ANALYSE_EMPREINTE}, ${ANALYSE_VIDEO}, suspect identifiÃ©" >> $GITHUB_OUTPUT
          echo "lieu=42 Avenue du Commerce, SupermarchÃ© SuperPrix" >> $GITHUB_OUTPUT
          echo "autorisation=true" >> $GITHUB_OUTPUT

  police:
    runs-on: ubuntu-latest
    needs: detective
    steps:
      - name: Lecture du rapport du dÃ©tective
        run: |
          echo "ğŸ“ Rapport : ${{ needs.detective.outputs.rapport }}"
          echo "ğŸ“ Lieu : ${{ needs.detective.outputs.lieu_arrestation }}"
          echo "âœ… Autorisation : ${{ needs.detective.outputs.autorisation_arrestation }}"

      - name: VÃ©rification de lâ€™autorisation
        if: needs.detective.outputs.autorisation_arrestation != 'true'
        run: echo "ğŸš« Pas d'autorisation â€“ enquÃªte classÃ©e sans suite."

      - name: Intervention
        if: needs.detective.outputs.autorisation_arrestation == 'true'
        run: echo "ğŸš“ Intervention en cours au 42 Avenue du Commerce"
